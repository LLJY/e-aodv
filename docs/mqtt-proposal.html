<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EAODV Network - MQTT Integration</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f7f9fc;
        }
        header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 30px;
        }
        h1 {
            margin: 0;
            font-size: 2.5em;
        }
        h2 {
            color: #2c3e50;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
            margin-top: 40px;
        }
        h3 {
            color: #34495e;
        }
        .subtitle {
            color: #95a5a6;
            font-size: 1.2em;
        }
        .nav {
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 30px;
        }
        .nav a {
            margin-right: 15px;
            color: #2980b9;
            text-decoration: none;
            font-weight: bold;
        }
        .nav a:hover {
            color: #3498db;
            text-decoration: underline;
        }
        .section {
            background-color: white;
            padding: 25px;
            border-radius: 5px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .note {
            background-color: #fffacd;
            border-left: 4px solid #f1c40f;
            padding: 15px;
            margin: 20px 0;
        }
        .warning {
            background-color: #fadbd8;
            border-left: 4px solid #e74c3c;
            padding: 15px;
            margin: 20px 0;
        }
        .diagram {
            text-align: center;
            margin: 30px 0;
        }
        .diagram img {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        .diagram svg {
            max-width: 100%;
        }
        .diagram-title {
            text-align: center;
            font-weight: bold;
            margin-top: 10px;
            color: #34495e;
        }
        .comparison {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 30px 0;
        }
        .comparison-column {
            flex: 1;
            min-width: 300px;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            border-top: 3px solid #3498db;
        }
        .comparison-column.eaodv {
            border-top-color: #3498db;
        }
        .comparison-column.eaodv h4 {
            color: #3498db;
        }
        .comparison-column.mqtt {
            border-top-color: #9b59b6;
        }
        .comparison-column.mqtt h4 {
            color: #9b59b6;
        }
        .comparison-column.bridge {
            border-top-color: #2ecc71;
        }
        .comparison-column.bridge h4 {
            color: #2ecc71;
        }
        .comparison-column h4 {
            margin-top: 0;
        }
        .step-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin: 30px 0;
        }
        .step {
            background-color: #fff;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin-bottom: 20px;
            width: 100%;
            box-sizing: border-box;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .step-number {
            background-color: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-block;
            text-align: center;
            line-height: 30px;
            margin-right: 10px;
        }
        .topic-list {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .topic {
            font-family: monospace;
            color: #e74c3c;
            padding: 3px 0;
        }
        .pro {
            color: #27ae60;
            font-weight: bold;
        }
        .con {
            color: #c0392b;
            font-weight: bold;
        }
        .json-example {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            margin: 15px 0;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <header>
        <h1>EAODV Network Documentation</h1>
        <p class="subtitle">Enhanced Ad-Hoc On-Demand Distance Vector Routing for BLE Networks</p>
    </header>

    <div class="nav">
        <a href="network-traversal.html">Packet Traversal</a>
        <a href="request-types.html">Request Types</a>
        <a href="information-propagation.html">Information Propagation</a>
        <a href="overall-flowchart.html">System Flowchart</a>
        <a href="mqtt-integration.html">MQTT Integration</a>
    </div>

    <div class="section">
        <h2>MQTT Integration Proposal</h2>

        <p>
            This document explores a potential future enhancement to the EAODV system: integration with
            MQTT (Message Queuing Telemetry Transport) to bridge your Bluetooth mesh network with
            IP-based networks and services.
        </p>

        <div class="note">
            <p>
                <strong>Note:</strong> This integration is a conceptual proposal rather than part of the current
                implementation. It represents a potential future direction for expanding the capabilities of your
                EAODV network beyond Bluetooth.
            </p>
        </div>

        <div class="diagram">
            <svg width="800" height="300" xmlns="http://www.w3.org/2000/svg">
                <!-- Background Rectangle -->
                <rect x="10" y="10" width="780" height="280" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2" rx="5" ry="5"/>

                <!-- Title -->
                <text x="400" y="40" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">MQTT Integration Conceptual Overview</text>

                <!-- EAODV Cloud -->
                <ellipse cx="200" cy="150" rx="150" ry="100" fill="#ebf5fb" stroke="#3498db" stroke-width="2"/>
                <text x="200" y="150" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">EAODV</text>
                <text x="200" y="170" text-anchor="middle" font-family="Arial" font-size="12">Bluetooth Mesh Network</text>

                <!-- Gateway Node -->
                <circle cx="400" cy="150" r="40" fill="#2ecc71" stroke="#27ae60" stroke-width="2"/>
                <text x="400" y="145" text-anchor="middle" font-family="Arial" font-size="14" fill="white" font-weight="bold">Gateway</text>
                <text x="400" y="165" text-anchor="middle" font-family="Arial" font-size="10" fill="white">Node</text>

                <!-- MQTT Cloud -->
                <ellipse cx="600" cy="150" rx="150" ry="100" fill="#f4ecf7" stroke="#9b59b6" stroke-width="2"/>
                <text x="600" y="150" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">MQTT</text>
                <text x="600" y="170" text-anchor="middle" font-family="Arial" font-size="12">TCP/IP Network</text>

                <!-- Connection Lines -->
                <line x1="275" y1="150" x2="360" y2="150" stroke="#3498db" stroke-width="3"/>
                <polygon points="360,150 350,145 350,155" fill="#3498db"/>
                <text x="320" y="135" text-anchor="middle" font-family="Arial" font-size="12">Bluetooth</text>

                <line x1="440" y1="150" x2="525" y2="150" stroke="#9b59b6" stroke-width="3"/>
                <polygon points="525,150 515,145 515,155" fill="#9b59b6"/>
                <text x="480" y="135" text-anchor="middle" font-family="Arial" font-size="12">TCP/IP</text>

                <!-- Nodes in EAODV network -->
                <circle cx="120" cy="120" r="15" fill="#3498db" stroke="#2980b9" stroke-width="1"/>
                <text x="120" y="124" text-anchor="middle" font-family="Arial" font-size="12" fill="white">N1</text>

                <circle cx="180" cy="100" r="15" fill="#3498db" stroke="#2980b9" stroke-width="1"/>
                <text x="180" y="104" text-anchor="middle" font-family="Arial" font-size="12" fill="white">N2</text>

                <circle cx="220" cy="180" r="15" fill="#3498db" stroke="#2980b9" stroke-width="1"/>
                <text x="220" y="184" text-anchor="middle" font-family="Arial" font-size="12" fill="white">N3</text>

                <circle cx="150" cy="200" r="15" fill="#3498db" stroke="#2980b9" stroke-width="1"/>
                <text x="150" y="204" text-anchor="middle" font-family="Arial" font-size="12" fill="white">N4</text>

                <!-- Lines connecting EAODV nodes -->
                <line x1="120" y1="120" x2="180" y2="100" stroke="#3498db" stroke-width="1"/>
                <line x1="180" y1="100" x2="220" y2="180" stroke="#3498db" stroke-width="1"/>
                <line x1="220" y1="180" x2="150" y2="200" stroke="#3498db" stroke-width="1"/>
                <line x1="150" y1="200" x2="120" y2="120" stroke="#3498db" stroke-width="1"/>

                <!-- Clients in MQTT network -->
                <rect x="550" y="100" width="60" height="30" fill="#9b59b6" stroke="#8e44ad" stroke-width="1" rx="3" ry="3"/>
                <text x="580" y="120" text-anchor="middle" font-family="Arial" font-size="12" fill="white">Client 1</text>

                <rect x="630" y="120" width="60" height="30" fill="#9b59b6" stroke="#8e44ad" stroke-width="1" rx="3" ry="3"/>
                <text x="660" y="140" text-anchor="middle" font-family="Arial" font-size="12" fill="white">Client 2</text>

                <rect x="580" y="200" width="60" height="30" fill="#9b59b6" stroke="#8e44ad" stroke-width="1" rx="3" ry="3"/>
                <text x="610" y="220" text-anchor="middle" font-family="Arial" font-size="12" fill="white">Client 3</text>
            </svg>
            <p class="diagram-title">Figure 1: MQTT Integration Conceptual Overview</p>
        </div>
    </div>

    <div class="section">
        <h3>What is MQTT?</h3>

        <p>
            MQTT (Message Queuing Telemetry Transport) is a lightweight, publish-subscribe network protocol
            that runs over TCP/IP. It is designed for connections with remote locations where a "small code
            footprint" is required or the network bandwidth is limited.
        </p>

        <h4>Key MQTT Characteristics:</h4>

        <ul>
            <li><strong>Publish/Subscribe Model:</strong> Unlike point-to-point communication, publishers send messages to topics, and subscribers receive messages from topics they're interested in</li>
            <li><strong>Minimal Protocol Overhead:</strong> Small header size (as little as 2 bytes) minimizes network traffic</li>
            <li><strong>Quality of Service Levels:</strong> Ensures message delivery through three QoS levels (0, 1, 2)</li>
            <li><strong>Last Will and Testament:</strong> Provides notification when a client disconnects unexpectedly</li>
            <li><strong>Retained Messages:</strong> Broker stores the last message sent to a topic, delivering it to new subscribers</li>
        </ul>

        <div class="diagram">
            <svg width="800" height="350" xmlns="http://www.w3.org/2000/svg">
                <!-- Background Rectangle -->
                <rect x="10" y="10" width="780" height="330" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2" rx="5" ry="5"/>

                <!-- Title -->
                <text x="400" y="40" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">MQTT Publish/Subscribe Model</text>

                <!-- MQTT Broker -->
                <rect x="320" y="80" width="160" height="80" fill="#9b59b6" stroke="#8e44ad" stroke-width="2" rx="5" ry="5"/>
                <text x="400" y="125" text-anchor="middle" font-family="Arial" font-size="16" fill="white" font-weight="bold">MQTT Broker</text>

                <!-- Topic Space -->
                <rect x="320" y="170" width="160" height="100" fill="#f4ecf7" stroke="#9b59b6" stroke-width="2" rx="5" ry="5"/>
                <text x="400" y="190" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold">Topic Space</text>

                <text x="360" y="215" text-anchor="middle" font-family="Arial" font-size="12">sensors/temp</text>
                <text x="360" y="235" text-anchor="middle" font-family="Arial" font-size="12">actuators/led</text>
                <text x="360" y="255" text-anchor="middle" font-family="Arial" font-size="12">status/node1</text>

                <!-- Publishers -->
                <rect x="100" y="120" width="120" height="60" fill="#3498db" stroke="#2980b9" stroke-width="2" rx="5" ry="5"/>
                <text x="160" y="150" text-anchor="middle" font-family="Arial" font-size="14" fill="white" font-weight="bold">Publishers</text>
                <text x="160" y="170" text-anchor="middle" font-family="Arial" font-size="12" fill="white">(Data Sources)</text>

                <!-- Subscribers -->
                <rect x="580" y="120" width="120" height="60" fill="#2ecc71" stroke="#27ae60" stroke-width="2" rx="5" ry="5"/>
                <text x="640" y="150" text-anchor="middle" font-family="Arial" font-size="14" fill="white" font-weight="bold">Subscribers</text>
                <text x="640" y="170" text-anchor="middle" font-family="Arial" font-size="12" fill="white">(Data Consumers)</text>

                <!-- Device Examples -->
                <circle cx="100" cy="250" r="20" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
                <text x="100" y="254" text-anchor="middle" font-family="Arial" font-size="12" fill="white">S1</text>

                <rect x="140" y="240" width="40" height="30" fill="#3498db" stroke="#2980b9" stroke-width="2" rx="3" ry="3"/>
                <text x="160" y="260" text-anchor="middle" font-family="Arial" font-size="12" fill="white">S2</text>

                <polygon points="100,300 120,280 80,280" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
                <text x="100" y="295" text-anchor="middle" font-family="Arial" font-size="12" fill="white">S3</text>

                <circle cx="640" cy="250" r="20" fill="#2ecc71" stroke="#27ae60" stroke-width="2"/>
                <text x="640" y="254" text-anchor="middle" font-family="Arial" font-size="12" fill="white">C1</text>

                <rect x="580" y="240" width="40" height="30" fill="#2ecc71" stroke="#27ae60" stroke-width="2" rx="3" ry="3"/>
                <text x="600" y="260" text-anchor="middle" font-family="Arial" font-size="12" fill="white">C2</text>

                <polygon points="640,300 660,280 620,280" fill="#2ecc71" stroke="#27ae60" stroke-width="2"/>
                <text x="640" y="295" text-anchor="middle" font-family="Arial" font-size="12" fill="white">C3</text>

                <!-- Publishing Arrows -->
                <line x1="220" y1="150" x2="320" y2="150" stroke="#3498db" stroke-width="2" stroke-dasharray="5,5"/>
                <polygon points="320,150 310,145 310,155" fill="#3498db"/>
                <text x="270" y="140" text-anchor="middle" font-family="Arial" font-size="12">Publish</text>

                <line x1="120" y1="250" x2="320" y2="215" stroke="#3498db" stroke-width="2" stroke-dasharray="5,5"/>
                <polygon points="320,215 310,210 310,220" fill="#3498db"/>

                <line x1="160" y1="255" x2="320" y2="235" stroke="#3498db" stroke-width="2" stroke-dasharray="5,5"/>
                <polygon points="320,235 310,230 310,240" fill="#3498db"/>

                <line x1="100" y1="280" x2="320" y2="255" stroke="#3498db" stroke-width="2" stroke-dasharray="5,5"/>
                <polygon points="320,255 310,250 310,260" fill="#3498db"/>

                <!-- Subscription Arrows -->
                <line x1="480" y1="150" x2="580" y2="150" stroke="#2ecc71" stroke-width="2"/>
                <polygon points="580,150 570,145 570,155" fill="#2ecc71"/>
                <text x="530" y="140" text-anchor="middle" font-family="Arial" font-size="12">Subscribe</text>

                <line x1="480" y1="215" x2="620" y2="250" stroke="#2ecc71" stroke-width="2"/>
                <polygon points="620,250 610,245 610,255" fill="#2ecc71"/>

                <line x1="480" y1="235" x2="580" y2="255" stroke="#2ecc71" stroke-width="2"/>
                <polygon points="580,255 570,250 570,260" fill="#2ecc71"/>

                <line x1="480" y1="255" x2="620" y2="290" stroke="#2ecc71" stroke-width="2"/>
                <polygon points="620,290 610,285 610,295" fill="#2ecc71"/>
            </svg>
            <p class="diagram-title">Figure 2: MQTT Publish/Subscribe Model</p>
        </div>

        <div class="comparison">
            <div class="comparison-column eaodv">
                <h4>EAODV Network</h4>
                <ul>
                    <li>Operates over Bluetooth Low Energy</li>
                    <li>Multi-hop mesh routing</li>
                    <li>Reactive/on-demand route discovery</li>
                    <li>Direct communication between nodes</li>
                    <li>Optimized for low-power devices</li>
                    <li>Limited network boundaries (BLE range)</li>
                </ul>
            </div>

            <div class="comparison-column mqtt">
                <h4>MQTT Protocol</h4>
                <ul>
                    <li>Operates over TCP/IP</li>
                    <li>Requires a central broker</li>
                    <li>Publish/subscribe communication model</li>
                    <li>Topic-based messaging</li>
                    <li>Can connect to cloud services</li>
                    <li>Global reach through internet connectivity</li>
                </ul>
            </div>

            <div class="comparison-column bridge">
                <h4>Integration Benefits</h4>
                <ul>
                    <li>Extends EAODV network beyond Bluetooth range</li>
                    <li>Enables data aggregation and centralized analysis</li>
                    <li>Connects to existing IoT platforms and services</li>
                    <li>Facilitates remote monitoring and control</li>
                    <li>Enables integration with web dashboards</li>
                    <li>Creates a unified IoT ecosystem</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="section">
        <h3>Gateway Approach for MQTT Integration</h3>

        <p>
            The most effective way to integrate EAODV with MQTT is through a "Gateway Node" approach,
            where one or more nodes in the EAODV network serve as bridges between the Bluetooth mesh
            and IP-based MQTT networks.
        </p>

        <div class="diagram">
            <svg width="800" height="500" xmlns="http://www.w3.org/2000/svg">
                <!-- Background Rectangle -->
                <rect x="10" y="10" width="780" height="480" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2" rx="5" ry="5"/>

                <!-- Title -->
                <text x="400" y="40" text-anchor="middle" font-family="Arial" font-size="20" font-weight="bold">EAODV-MQTT Gateway Architecture</text>

                <!-- EAODV Network Area -->
                <rect x="50" y="80" width="300" height="350" fill="#ebf5fb" stroke="#3498db" stroke-width="2" rx="5" ry="5"/>
                <text x="200" y="100" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">EAODV Bluetooth Mesh</text>

                <!-- MQTT/IP Network Area -->
                <rect x="450" y="80" width="300" height="350" fill="#f4ecf7" stroke="#9b59b6" stroke-width="2" rx="5" ry="5"/>
                <text x="600" y="100" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">MQTT/IP Network</text>

                <!-- EAODV Nodes -->
                <circle cx="100" cy="150" r="20" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
                <text x="100" y="155" text-anchor="middle" font-family="Arial" font-size="12" fill="white">A</text>

                <circle cx="150" cy="200" r="20" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
                <text x="150" y="205" text-anchor="middle" font-family="Arial" font-size="12" fill="white">B</text>

                <circle cx="100" cy="250" r="20" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
                <text x="100" y="255" text-anchor="middle" font-family="Arial" font-size="12" fill="white">C</text>

                <circle cx="200" cy="300" r="20" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
                <text x="200" y="305" text-anchor="middle" font-family="Arial" font-size="12" fill="white">D</text>

                <circle cx="250" cy="250" r="20" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
                <text x="250" y="255" text-anchor="middle" font-family="Arial" font-size="12" fill="white">E</text>

                <!-- Gateway Node -->
                <circle cx="300" cy="200" r="25" fill="#2ecc71" stroke="#27ae60" stroke-width="3"/>
                <text x="300" y="205" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="white">GW</text>

                <!-- MQTT Broker -->
                <rect x="525" y="180" width="150" height="80" fill="#9b59b6" stroke="#8e44ad" stroke-width="2" rx="5" ry="5"/>
                <text x="600" y="220" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold" fill="white">MQTT Broker</text>

                <!-- MQTT Clients -->
                <rect x="500" y="300" width="80" height="50" fill="#9b59b6" stroke="#8e44ad" stroke-width="2" rx="5" ry="5"/>
                <text x="540" y="330" text-anchor="middle" font-family="Arial" font-size="12" fill="white">Dashboard</text>

                <rect x="620" y="300" width="80" height="50" fill="#9b59b6" stroke="#8e44ad" stroke-width="2" rx="5" ry="5"/>
                <text x="660" y="330" text-anchor="middle" font-family="Arial" font-size="12" fill="white">Cloud App</text>

                <!-- EAODV Node Connections -->
                <line x1="100" y1="150" x2="150" y2="200" stroke="#3498db" stroke-width="2"/>
                <line x1="150" y1="200" x2="100" y2="250" stroke="#3498db" stroke-width="2"/>
                <line x1="150" y1="200" x2="200" y2="300" stroke="#3498db" stroke-width="2"/>
                <line x1="150" y1="200" x2="250" y2="250" stroke="#3498db" stroke-width="2"/>
                <line x1="200" y1="300" x2="250" y2="250" stroke="#3498db" stroke-width="2"/>
                <line x1="150" y1="200" x2="300" y2="200" stroke="#3498db" stroke-width="2"/>
                <line x1="250" y1="250" x2="300" y2="200" stroke="#3498db" stroke-width="2"/>

                <!-- Gateway to MQTT Connection -->
                <line x1="325" y1="200" x2="525" y2="200" stroke="#2ecc71" stroke-width="3" stroke-dasharray="10,5"/>

                <!-- MQTT Connections -->
                <line x1="540" y1="300" x2="566" y2="260" stroke="#9b59b6" stroke-width="2"/>
                <line x1="660" y1="300" x2="634" y2="260" stroke="#9b59b6" stroke-width="2"/>

                <!-- Labels -->
                <text x="70" y="380" font-family="Arial" font-size="14" fill="#2980b9">EAODV Nodes</text>
                <text x="300" y="150" font-family="Arial" font-size="14" fill="#27ae60">Gateway Node</text>
                <text x="600" y="150" font-family="Arial" font-size="14" fill="#8e44ad">MQTT Broker</text>
                <text x="400" y="190" font-family="Arial" font-size="14" fill="#27ae60">TCP/IP Connection</text>
                <text x="600" y="380" font-family="Arial" font-size="14" fill="#8e44ad">MQTT Clients</text>
            </svg>
            <p class="diagram-title">Figure 3: EAODV-MQTT Gateway Architecture</p>
        </div>

        <h4>Gateway Node Responsibilities:</h4>

        <ul>
            <li><strong>Dual Connectivity:</strong> Maintain both Bluetooth (for EAODV mesh) and WiFi/Ethernet (for MQTT) connections</li>
            <li><strong>Protocol Translation:</strong> Convert between EAODV messages and MQTT publications/subscriptions</li>
            <li><strong>Topic Management:</strong> Map EAODV node IDs and capabilities to appropriate MQTT topics</li>
            <li><strong>Data Aggregation:</strong> Collect and potentially process data from the EAODV network before publishing to MQTT</li>
            <li><strong>Command Distribution:</strong> Subscribe to command topics and translate them to appropriate EAODV operations</li>
        </ul>
    </div>

    <div class="section">
        <h3>Failsafe MQTT Integration</h3>

        <p>
            A robust MQTT integration should include failsafe mechanisms to ensure continuity of operation even when
            network conditions change. This section proposes a resilient approach for integrating MQTT with EAODV networks.
        </p>

        <div class="diagram">
            <svg width="850" height="550" xmlns="http://www.w3.org/2000/svg">
            <!-- Background Rectangle -->
            <rect x="10" y="10" width="830" height="530" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2" rx="5" ry="5"/>

            <!-- Title -->
            <text x="425" y="40" text-anchor="middle" font-family="Arial" font-size="22" font-weight="bold">MQTT Failsafe Architecture</text>

            <!-- EAODV Network Box -->
            <rect x="50" y="80" width="750" height="420" fill="#ebf5fb" stroke="#3498db" stroke-width="2" rx="5" ry="5"/>
            <text x="425" y="100" text-anchor="middle" font-family="Arial" font-size="18" font-weight="bold">EAODV Bluetooth Mesh Network</text>

            <!-- Internet Cloud -->
            <ellipse cx="425" cy="150" rx="160" ry="40" fill="white" stroke="#95a5a6" stroke-width="2"/>
            <text x="425" y="155" text-anchor="middle" font-family="Arial" font-size="16" fill="#95a5a6">Internet / MQTT Broker</text>

            <!-- Regular Nodes - Better positioned -->
            <circle cx="120" cy="220" r="25" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
            <text x="120" cy="225" text-anchor="middle" font-family="Arial" font-size="14" fill="white">N1</text>

            <circle cx="250" cy="180" r="25" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
            <text x="250" cy="185" text-anchor="middle" font-family="Arial" font-size="14" fill="white">N2</text>

            <circle cx="180" cy="350" r="25" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
            <text x="180" cy="355" text-anchor="middle" font-family="Arial" font-size="14" fill="white">N3</text>

            <circle cx="320" cy="420" r="25" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
            <text x="320" cy="425" text-anchor="middle" font-family="Arial" font-size="14" fill="white">N4</text>

            <circle cx="520" cy="420" r="25" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
            <text x="520" cy="425" text-anchor="middle" font-family="Arial" font-size="14" fill="white">N5</text>

            <circle cx="700" cy="350" r="25" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
            <text x="700" cy="355" text-anchor="middle" font-family="Arial" font-size="14" fill="white">N6</text>

            <!-- WiFi Capable Nodes - Primary Broker -->
            <circle cx="425" cy="250" r="35" fill="#2ecc71" stroke="#27ae60" stroke-width="3"/>
            <text x="425" cy="245" text-anchor="middle" font-family="Arial" font-size="16" fill="white" font-weight="bold">GW1</text>
            <text x="425" cy="265" text-anchor="middle" font-family="Arial" font-size="12" fill="white">Primary</text>

            <!-- WiFi Icon for Primary -->
            <path d="M390,230 Q425,200 460,230" stroke="white" stroke-width="2.5" fill="none"/>
            <path d="M400,240 Q425,215 450,240" stroke="white" stroke-width="2.5" fill="none"/>
            <path d="M410,250 Q425,235 440,250" stroke="white" stroke-width="2.5" fill="none"/>
            <circle cx="425" cy="255" r="3.5" fill="white"/>

            <!-- Backup Broker 1 -->
            <circle cx="600" cy="220" r="30" fill="#e67e22" stroke="#d35400" stroke-width="2.5"/>
            <text x="600" cy="215" text-anchor="middle" font-family="Arial" font-size="16" fill="white" font-weight="bold">GW2</text>
            <text x="600" cy="235" text-anchor="middle" font-family="Arial" font-size="12" fill="white">Backup 1</text>

            <!-- WiFi Icon for Backup 1 -->
            <path d="M575,205 Q600,180 625,205" stroke="white" stroke-width="2" fill="none"/>
            <path d="M585,215 Q600,195 615,215" stroke="white" stroke-width="2" fill="none"/>
            <circle cx="600" cy="225" r="3" fill="white"/>

            <!-- Backup Broker 2 -->
            <circle cx="280" cy="280" r="30" fill="#e67e22" stroke="#d35400" stroke-width="2.5"/>
            <text x="280" cy="275" text-anchor="middle" font-family="Arial" font-size="16" fill="white" font-weight="bold">GW3</text>
            <text x="280" cy="295" text-anchor="middle" font-family="Arial" font-size="12" fill="white">Backup 2</text>

            <!-- WiFi Icon for Backup 2 (weaker) -->
            <path d="M255,265 Q280,240 305,265" stroke="white" stroke-width="1.5" fill="none" stroke-dasharray="3,1.5"/>
            <path d="M265,275 Q280,255 295,275" stroke="white" stroke-width="1.5" fill="none" stroke-dasharray="3,1.5"/>
            <circle cx="280" cy="285" r="2.5" fill="white"/>

            <!-- Connections between EAODV nodes - better arranged -->
            <line x1="120" y1="220" x2="250" y2="180" stroke="#3498db" stroke-width="2"/>
            <line x1="120" y1="220" x2="180" y2="350" stroke="#3498db" stroke-width="2"/>
            <line x1="250" y1="180" x2="425" y2="250" stroke="#3498db" stroke-width="2"/>
            <line x1="280" y1="280" x2="180" y2="350" stroke="#3498db" stroke-width="2"/>
            <line x1="180" y1="350" x2="320" y2="420" stroke="#3498db" stroke-width="2"/>
            <line x1="320" y1="420" x2="520" y2="420" stroke="#3498db" stroke-width="2"/>
            <line x1="520" y1="420" x2="700" y2="350" stroke="#3498db" stroke-width="2"/>
            <line x1="425" y1="250" x2="600" y2="220" stroke="#3498db" stroke-width="2"/>
            <line x1="600" y1="220" x2="700" y2="350" stroke="#3498db" stroke-width="2"/>
            <line x1="250" y1="180" x2="280" y2="280" stroke="#3498db" stroke-width="2"/>

            <!-- Connection to cloud -->
            <line x1="425" y1="215" x2="425" y2="160" stroke="#2ecc71" stroke-width="4"/>
            <polygon points="425,160 418,175 432,175" fill="#2ecc71"/>
            <text x="400" y="185" font-family="Arial" font-size="14" fill="#27ae60" font-weight="bold">Strong</text>

            <line x1="600" y1="190" x2="530" y2="160" stroke="#e67e22" stroke-width="2.5" stroke-dasharray="6,3"/>
            <polygon points="530,160 525,170 535,170" fill="#e67e22"/>
            <text x="580" y="170" font-family="Arial" font-size="14" fill="#d35400" font-weight="bold">Medium</text>

            <line x1="280" y1="250" x2="350" y2="170" stroke="#e67e22" stroke-width="1.5" stroke-dasharray="4,3"/>
            <polygon points="350,170 345,180 355,180" fill="#e67e22"/>
            <text x="250" y="210" font-family="Arial" font-size="14" fill="#d35400" font-weight="bold">Weak</text>

            <!-- Decision process indication - moved to avoid overlaps -->
            <ellipse cx="425" cy="335" rx="120" ry="50" fill="#fffacd" stroke="#f1c40f" stroke-width="2.5" fill-opacity="0.7"/>
            <text x="425" y="320" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">Broker Election</text>
            <text x="425" y="345" text-anchor="middle" font-family="Arial" font-size="14">• WiFi Strength</text>
            <text x="425" y="370" text-anchor="middle" font-family="Arial" font-size="14">• MAC Address</text>

            <!-- Dashed lines to election process -->
            <line x1="425" y1="285" x2="425" y2="300" stroke="#2ecc71" stroke-width="2" stroke-dasharray="5,3"/>
            <line x1="600" y1="250" x2="510" y2="305" stroke="#e67e22" stroke-width="2" stroke-dasharray="5,3"/>
            <line x1="280" y1="310" x2="340" y2="325" stroke="#e67e22" stroke-width="2" stroke-dasharray="5,3"/>

            <!-- Legend -->
            <rect x="85" y="475" width="680" height="30" fill="#eaf2f8" stroke="#3498db" stroke-width="1" rx="5" ry="5"/>
            <circle cx="110" cy="490" r="10" fill="#3498db" stroke="#2980b9" stroke-width="1.5"/>
            <text x="130" y="495" font-family="Arial" font-size="14">Regular Node</text>

            <circle cx="250" cy="490" r="12" fill="#2ecc71" stroke="#27ae60" stroke-width="1.5"/>
            <text x="270" y="495" font-family="Arial" font-size="14">Primary Broker</text>

            <circle cx="415" cy="490" r="10" fill="#e67e22" stroke="#d35400" stroke-width="1.5"/>
            <text x="435" y="495" font-family="Arial" font-size="14">Backup Broker</text>

            <line x1="550" y1="490" x2="580" y2="490" stroke="#2ecc71" stroke-width="2.5"/>
            <text x="610" y="495" font-family="Arial" font-size="14">Strong Connection</text>

            <line x1="700" y1="490" x2="730" y2="490" stroke="#e67e22" stroke-width="1.5" stroke-dasharray="4,2"/>
            <text x="755" y="495" font-family="Arial" font-size="14">Weak Connection</text>
        </svg>
            <p class="diagram-title">Figure 4: MQTT Failsafe Architecture with Dynamic Broker Election</p>
        </div>

        <h4>WiFi Connection Monitoring</h4>
        <ul>
            <li><strong>Connection State Detection:</strong> Gateway nodes continuously monitor their WiFi connection state</li>
            <li><strong>Signal Strength Tracking:</strong> Monitor WiFi signal strength (RSSI) to evaluate connection quality</li>
            <li><strong>Internet Connectivity Verification:</strong> Periodically check actual internet connectivity through heartbeat pings to MQTT broker</li>
            <li><strong>Connection Recovery:</strong> Implement automatic reconnection procedures for intermittent connectivity</li>
        </ul>

        <h4>Dynamic MQTT Broker Election</h4>
        <p>
            Instead of relying on a single gateway node, the system supports dynamic broker election:
        </p>

        <ol>
            <li><strong>Broker Candidacy:</strong> Any node with WiFi capability can become an MQTT broker candidate</li>
            <li><strong>Eligibility Criteria:</strong>
                <ul>
                    <li>WiFi connection availability</li>
                    <li>Connection strength (RSSI)</li>
                    <li>Processing resources available</li>
                    <li>Battery status (for battery-powered nodes)</li>
                    <li>Uptime stability</li>
                </ul>
            </li>
            <li><strong>Election Process:</strong>
                <ol>
                    <li>Nodes broadcast their broker suitability score based on eligibility criteria</li>
                    <li>Node with highest suitability score becomes primary broker</li>
                    <li>One or more backup brokers are also elected</li>
                    <li>MAC address used as tiebreaker if scores are identical</li>
                </ol>
            </li>
            <li><strong>Broker Handover:</strong>
                <ul>
                    <li>Periodic re-evaluation of broker suitability</li>
                    <li>Graceful handover when a more suitable broker is identified</li>
                    <li>Automatic failover to backup broker if primary fails</li>
                </ul>
            </li>
        </ol>

        <div class="diagram">
            <svg width="800" height="400" xmlns="http://www.w3.org/2000/svg">
                <!-- Background Rectangle -->
                <rect x="10" y="10" width="780" height="380" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2" rx="5" ry="5"/>

                <!-- Title -->
                <text x="400" y="40" text-anchor="middle" font-family="Arial" font-size="18" font-weight="bold">MQTT Broker Election Process</text>

                <!-- Timeline -->
                <line x1="100" y1="100" x2="700" y2="100" stroke="#95a5a6" stroke-width="2"/>
                <line x1="100" y1="98" x2="100" y2="102" stroke="#95a5a6" stroke-width="2"/>
                <line x1="250" y1="98" x2="250" y2="102" stroke="#95a5a6" stroke-width="2"/>
                <line x1="400" y1="98" x2="400" y2="102" stroke="#95a5a6" stroke-width="2"/>
                <line x1="550" y1="98" x2="550" y2="102" stroke="#95a5a6" stroke-width="2"/>
                <line x1="700" y1="98" x2="700" y2="102" stroke="#95a5a6" stroke-width="2"/>

                <text x="100" y="120" text-anchor="middle" font-family="Arial" font-size="12">Initial</text>
                <text x="250" y="120" text-anchor="middle" font-family="Arial" font-size="12">Election</text>
                <text x="400" y="120" text-anchor="middle" font-family="Arial" font-size="12">Normal Operation</text>
                <text x="550" y="120" text-anchor="middle" font-family="Arial" font-size="12">Primary Fails</text>
                <text x="700" y="120" text-anchor="middle" font-family="Arial" font-size="12">Failover Complete</text>

                <!-- Node states across timeline -->
                <!-- Node GW1 -->
                <line x1="100" y1="150" x2="700" y2="150" stroke="#eee" stroke-width="1" stroke-dasharray="5,5"/>
                <text x="50" y="150" text-anchor="end" font-family="Arial" font-size="12" font-weight="bold">GW1</text>

                <circle cx="100" cy="150" r="10" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
                <circle cx="250" cy="150" r="15" fill="#2ecc71" stroke="#27ae60" stroke-width="2"/>
                <circle cx="400" cy="150" r="15" fill="#2ecc71" stroke="#27ae60" stroke-width="2"/>
                <circle cx="550" cy="150" r="15" fill="#e74c3c" stroke="#c0392b" stroke-width="2"/>
                <circle cx="700" cy="150" r="10" fill="#3498db" stroke="#2980b9" stroke-width="2"/>

                <!-- Node GW2 -->
                <line x1="100" y1="200" x2="700" y2="200" stroke="#eee" stroke-width="1" stroke-dasharray="5,5"/>
                <text x="50" y="200" text-anchor="end" font-family="Arial" font-size="12" font-weight="bold">GW2</text>

                <circle cx="100" cy="200" r="10" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
                <circle cx="250" cy="200" r="12" fill="#e67e22" stroke="#d35400" stroke-width="2"/>
                <circle cx="400" cy="200" r="12" fill="#e67e22" stroke="#d35400" stroke-width="2"/>
                <circle cx="550" cy="200" r="12" fill="#e67e22" stroke="#d35400" stroke-width="2"/>
                <circle cx="700" cy="200" r="15" fill="#2ecc71" stroke="#27ae60" stroke-width="2"/>

                <!-- Node GW3 -->
                <line x1="100" y1="250" x2="700" y2="250" stroke="#eee" stroke-width="1" stroke-dasharray="5,5"/>
                <text x="50" y="250" text-anchor="end" font-family="Arial" font-size="12" font-weight="bold">GW3</text>

                <circle cx="100" cy="250" r="10" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
                <circle cx="250" cy="250" r="8" fill="#95a5a6" stroke="#7f8c8d" stroke-width="2"/>
                <circle cx="400" cy="250" r="8" fill="#95a5a6" stroke="#7f8c8d" stroke-width="2"/>
                <circle cx="550" cy="250" r="8" fill="#95a5a6" stroke="#7f8c8d" stroke-width="2"/>
                <circle cx="700" cy="250" r="12" fill="#e67e22" stroke="#d35400" stroke-width="2"/>

                <!-- Legend -->
                <circle cx="100" cy="320" r="10" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
                <text x="120" y="325" font-family="Arial" font-size="12">Regular Node</text>

                <circle cx="250" cy="320" r="15" fill="#2ecc71" stroke="#27ae60" stroke-width="2"/>
                <text x="270" y="325" font-family="Arial" font-size="12">Primary Broker</text>

                <circle cx="400" cy="320" r="12" fill="#e67e22" stroke="#d35400" stroke-width="2"/>
                <text x="420" y="325" font-family="Arial" font-size="12">Backup Broker</text>

                <circle cx="550" cy="320" r="8" fill="#95a5a6" stroke="#7f8c8d" stroke-width="2"/>
                <text x="570" y="325" font-family="Arial" font-size="12">Ineligible Node</text>

                <circle cx="700" cy="320" r="15" fill="#e74c3c" stroke="#c0392b" stroke-width="2"/>
                <text x="720" y="325" font-family="Arial" font-size="12">Failed Node</text>

                <!-- Connection arrows -->
                <line x1="150" y1="150" x2="200" y2="150" stroke="#3498db" stroke-width="2" stroke-dasharray="5,3"/>
                <polygon points="200,150 190,145 190,155" fill="#3498db"/>

                <line x1="450" y1="150" x2="500" y2="150" stroke="#2ecc71" stroke-width="2" stroke-dasharray="5,3"/>
                <polygon points="500,150 490,145 490,155" fill="#2ecc71"/>

                <line x1="600" y1="200" x2="650" y2="200" stroke="#e67e22" stroke-width="2" stroke-dasharray="5,3"/>
                <polygon points="650,200 640,195 640,205" fill="#e67e22"/>

                <!-- Status indicators -->
                <text x="250" y="170" text-anchor="middle" font-family="Arial" font-size="10">Primary</text>
                <text x="400" y="170" text-anchor="middle" font-family="Arial" font-size="10">Primary</text>
                <text x="550" y="170" text-anchor="middle" font-family="Arial" font-size="10">Failed</text>

                <text x="250" y="220" text-anchor="middle" font-family="Arial" font-size="10">Backup</text>
                <text x="400" y="220" text-anchor="middle" font-family="Arial" font-size="10">Backup</text>
                <text x="550" y="220" text-anchor="middle" font-family="Arial" font-size="10">Backup</text>
                <text x="700" y="220" text-anchor="middle" font-family="Arial" font-size="10">Primary</text>

                <text x="700" y="270" text-anchor="middle" font-family="Arial" font-size="10">Backup</text>
            </svg>
            <p class="diagram-title">Figure 5: MQTT Broker Election and Failover Process</p>
        </div>
    </div>

    <div class="section">
        <h3>MQTT Topic Structure</h3>

        <p>
            A consistent topic hierarchy is essential for mapping EAODV network structure and capabilities:
        </p>

        <div class="diagram">
            <svg width="800" height="400" xmlns="http://www.w3.org/2000/svg">
                <!-- Background Rectangle -->
                <rect x="10" y="10" width="780" height="380" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2" rx="5" ry="5"/>

                <!-- Title -->
                <text x="400" y="40" text-anchor="middle" font-family="Arial" font-size="18" font-weight="bold">MQTT Topic Hierarchy</text>

                <!-- Topic Tree -->
                <!-- Root -->
                <rect x="375" y="70" width="50" height="30" fill="#9b59b6" stroke="#8e44ad" stroke-width="2" rx="5" ry="5"/>
                <text x="400" y="90" text-anchor="middle" font-family="Arial" font-size="14" fill="white">eaodv</text>

                <!-- Main branches -->
                <rect x="200" y="130" width="80" height="30" fill="#3498db" stroke="#2980b9" stroke-width="2" rx="5" ry="5"/>
                <text x="240" y="150" text-anchor="middle" font-family="Arial" font-size="14" fill="white">nodes</text>

                <rect x="400" y="130" width="80" height="30" fill="#3498db" stroke="#2980b9" stroke-width="2" rx="5" ry="5"/>
                <text x="440" y="150" text-anchor="middle" font-family="Arial" font-size="14" fill="white">network</text>

                <rect x="600" y="130" width="80" height="30" fill="#3498db" stroke="#2980b9" stroke-width="2" rx="5" ry="5"/>
                <text x="640" y="150" text-anchor="middle" font-family="Arial" font-size="14" fill="white">gateway</text>

                <!-- Node branches -->
                <rect x="120" y="190" width="80" height="30" fill="#e74c3c" stroke="#c0392b" stroke-width="2" rx="5" ry="5"/>
                <text x="160" y="210" text-anchor="middle" font-family="Arial" font-size="12" fill="white">node-A/+</text>

                <rect x="220" y="190" width="80" height="30" fill="#e74c3c" stroke="#c0392b" stroke-width="2" rx="5" ry="5"/>
                <text x="260" y="210" text-anchor="middle" font-family="Arial" font-size="12" fill="white">node-B/+</text>

                <rect x="320" y="190" width="80" height="30" fill="#e74c3c" stroke="#c0392b" stroke-width="2" rx="5" ry="5"/>
                <text x="360" y="210" text-anchor="middle" font-family="Arial" font-size="12" fill="white">node-C/+</text>

                <!-- Network branches -->
                <rect x="350" y="190" width="80" height="30" fill="#e67e22" stroke="#d35400" stroke-width="2" rx="5" ry="5"/>
                <text x="390" y="210" text-anchor="middle" font-family="Arial" font-size="12" fill="white">topology</text>

                <rect x="450" y="190" width="80" height="30" fill="#e67e22" stroke="#d35400" stroke-width="2" rx="5" ry="5"/>
                <text x="490" y="210" text-anchor="middle" font-family="Arial" font-size="12" fill="white">config</text>

                <!-- Gateway branches -->
                <rect x="550" y="190" width="80" height="30" fill="#16a085" stroke="#1abc9c" stroke-width="2" rx="5" ry="5"/>
                <text x="590" y="210" text-anchor="middle" font-family="Arial" font-size="12" fill="white">status</text>

                <rect x="650" y="190" width="80" height="30" fill="#16a085" stroke="#1abc9c" stroke-width="2" rx="5" ry="5"/>
                <text x="690" y="210" text-anchor="middle" font-family="Arial" font-size="12" fill="white">election</text>

                <!-- Node node-A sub-branches -->
                <rect x="80" y="250" width="80" height="25" fill="#2ecc71" stroke="#27ae60" stroke-width="1" rx="3" ry="3"/>
                <text x="120" y="267" text-anchor="middle" font-family="Arial" font-size="11" fill="white">sensors/+</text>

                <rect x="170" y="250" width="80" height="25" fill="#2ecc71" stroke="#27ae60" stroke-width="1" rx="3" ry="3"/>
                <text x="210" y="267" text-anchor="middle" font-family="Arial" font-size="11" fill="white">actuators/+</text>

                <rect x="125" y="290" width="80" height="25" fill="#2ecc71" stroke="#27ae60" stroke-width="1" rx="3" ry="3"/>
                <text x="165" y="307" text-anchor="middle" font-family="Arial" font-size="11" fill="white">capabilities</text>

                <!-- Network config sub-branches -->
                <rect x="450" y="250" width="80" height="25" fill="#8e44ad" stroke="#9b59b6" stroke-width="1" rx="3" ry="3"/>
                <text x="490" y="267" text-anchor="middle" font-family="Arial" font-size="11" fill="white">set</text>

                <!-- Connection lines -->
                <!-- Root to main branches -->
                <line x1="400" y1="100" x2="400" y2="120" stroke="#9b59b6" stroke-width="1.5"/>
                <line x1="400" y1="120" x2="240" y2="120" stroke="#9b59b6" stroke-width="1.5"/>
                <line x1="240" y1="120" x2="240" y2="130" stroke="#9b59b6" stroke-width="1.5"/>

                <line x1="400" y1="100" x2="400" y2="130" stroke="#9b59b6" stroke-width="1.5"/>

                <line x1="400" y1="100" x2="400" y2="120" stroke="#9b59b6" stroke-width="1.5"/>
                <line x1="400" y1="120" x2="640" y2="120" stroke="#9b59b6" stroke-width="1.5"/>
                <line x1="640" y1="120" x2="640" y2="130" stroke="#9b59b6" stroke-width="1.5"/>

                <!-- Nodes to node branches -->
                <line x1="240" y1="160" x2="240" y2="175" stroke="#3498db" stroke-width="1.5"/>
                <line x1="240" y1="175" x2="160" y2="175" stroke="#3498db" stroke-width="1.5"/>
                <line x1="160" y1="175" x2="160" y2="190" stroke="#3498db" stroke-width="1.5"/>

                <line x1="240" y1="160" x2="240" y2="175" stroke="#3498db" stroke-width="1.5"/>
                <line x1="240" y1="175" x2="260" y2="175" stroke="#3498db" stroke-width="1.5"/>
                <line x1="260" y1="175" x2="260" y2="190" stroke="#3498db" stroke-width="1.5"/>

                <line x1="240" y1="160" x2="240" y2="175" stroke="#3498db" stroke-width="1.5"/>
                <line x1="240" y1="175" x2="360" y2="175" stroke="#3498db" stroke-width="1.5"/>
                <line x1="360" y1="175" x2="360" y2="190" stroke="#3498db" stroke-width="1.5"/>

                <!-- Network to network branches -->
                <line x1="440" y1="160" x2="440" y2="175" stroke="#3498db" stroke-width="1.5"/>
                <line x1="440" y1="175" x2="390" y2="175" stroke="#3498db" stroke-width="1.5"/>
                <line x1="390" y1="175" x2="390" y2="190" stroke="#3498db" stroke-width="1.5"/>

                <line x1="440" y1="160" x2="440" y2="175" stroke="#3498db" stroke-width="1.5"/>
                <line x1="440" y1="175" x2="490" y2="175" stroke="#3498db" stroke-width="1.5"/>
                <line x1="490" y1="175" x2="490" y2="190" stroke="#3498db" stroke-width="1.5"/>

                <!-- Gateway to gateway branches -->
                <line x1="640" y1="160" x2="640" y2="175" stroke="#3498db" stroke-width="1.5"/>
                <line x1="640" y1="175" x2="590" y2="175" stroke="#3498db" stroke-width="1.5"/>
                <line x1="590" y1="175" x2="590" y2="190" stroke="#3498db" stroke-width="1.5"/>

                <line x1="640" y1="160" x2="640" y2="175" stroke="#3498db" stroke-width="1.5"/>
                <line x1="640" y1="175" x2="690" y2="175" stroke="#3498db" stroke-width="1.5"/>
                <line x1="690" y1="175" x2="690" y2="190" stroke="#3498db" stroke-width="1.5"/>

                <!-- Node-A to sensor/actuators -->
                <line x1="160" y1="220" x2="160" y2="235" stroke="#e74c3c" stroke-width="1"/>
                <line x1="160" y1="235" x2="120" y2="235" stroke="#e74c3c" stroke-width="1"/>
                <line x1="120" y1="235" x2="120" y2="250" stroke="#e74c3c" stroke-width="1"/>

                <line x1="160" y1="220" x2="160" y2="235" stroke="#e74c3c" stroke-width="1"/>
                <line x1="160" y1="235" x2="210" y2="235" stroke="#e74c3c" stroke-width="1"/>
                <line x1="210" y1="235" x2="210" y2="250" stroke="#e74c3c" stroke-width="1"/>

                <line x1="160" y1="220" x2="160" y2="265" stroke="#e74c3c" stroke-width="1"/>
                <line x1="160" y1="265" x2="165" y2="265" stroke="#e74c3c" stroke-width="1"/>
                <line x1="165" y1="265" x2="165" y2="290" stroke="#e74c3c" stroke-width="1"/>

                <!-- Network config to set -->
                <line x1="490" y1="220" x2="490" y2="250" stroke="#e67e22" stroke-width="1"/>

                <!-- Topics listing -->
                <text x="100" y="345" font-family="Arial" font-size="12" font-weight="bold">Example Topics:</text>
                <text x="120" y="365" font-family="Arial" font-size="11" font-style="italic">eaodv/nodes/+/sensors/+</text>
                <text x="120" y="385" font-family="Arial" font-size="11" font-style="italic">eaodv/nodes/+/actuators/+/set</text>
                <text x="400" y="365" font-family="Arial" font-size="11" font-style="italic">eaodv/network/topology</text>
                <text x="400" y="385" font-family="Arial" font-size="11" font-style="italic">eaodv/gateway/election</text>
            </svg>
            <p class="diagram-title">Figure 6: MQTT Topic Hierarchy for EAODV Integration</p>
        </div>

        <div class="topic-list">
            <div class="topic">eaodv/nodes/+/sensors/+            # Sensor data from nodes</div>
            <div class="topic">eaodv/nodes/+/actuators/+/set      # Commands for node actuators</div>
            <div class="topic">eaodv/nodes/+/capabilities         # Node capability information</div>
            <div class="topic">eaodv/network/topology             # Network topology information</div>
            <div class="topic">eaodv/network/config/set           # Network configuration commands</div>
            <div class="topic">eaodv/gateway/status               # Gateway node status information</div>
            <div class="topic">eaodv/broker/election              # Broker election and status information</div>
        </div>
    </div>

    <div class="section">
        <h3>Data and Command Mapping</h3>

        <p>
            A key aspect of the gateway implementation is mapping between EAODV concepts and MQTT topics/payloads.
            Here's how various types of data and commands would be mapped:
        </p>

        <div class="diagram">
            <svg width="800" height="300" xmlns="http://www.w3.org/2000/svg">
                <!-- Background Rectangle -->
                <rect x="10" y="10" width="780" height="280" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2" rx="5" ry="5"/>

                <!-- Title -->
                <text x="400" y="40" text-anchor="middle" font-family="Arial" font-size="18" font-weight="bold">EAODV to MQTT Data Mapping</text>

                <!-- EAODV Side -->
                <rect x="100" y="80" width="200" height="180" fill="#ebf5fb" stroke="#3498db" stroke-width="2" rx="5" ry="5"/>
                <text x="200" y="100" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold">EAODV Data</text>

                <!-- MQTT Side -->
                <rect x="500" y="80" width="200" height="180" fill="#f4ecf7" stroke="#9b59b6" stroke-width="2" rx="5" ry="5"/>
                <text x="600" y="100" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold">MQTT Topic & Payload</text>

                <!-- Mapping arrow -->
                <line x1="300" y1="170" x2="500" y2="170" stroke="#2ecc71" stroke-width="3" stroke-dasharray="5,5"/>
                <polygon points="500,170 490,165 490,175" fill="#2ecc71"/>
                <text x="400" y="155" text-anchor="middle" font-family="Arial" font-size="16" fill="#2ecc71">Gateway</text>
                <text x="400" y="175" text-anchor="middle" font-family="Arial" font-size="16" fill="#2ecc71">Translation</text>

                <!-- EAODV Data Format -->
                <rect x="120" y="130" width="160" height="30" fill="#3498db" stroke="#2980b9" stroke-width="1" rx="3" ry="3"/>
                <text x="200" y="150" text-anchor="middle" font-family="Arial" font-size="12" fill="white">Read Operation (QUERY)</text>

                <rect x="120" y="170" width="160" height="30" fill="#3498db" stroke="#2980b9" stroke-width="1" rx="3" ry="3"/>
                <text x="200" y="190" text-anchor="middle" font-family="Arial" font-size="12" fill="white">Write Operation (WRITE)</text>

                <rect x="120" y="210" width="160" height="30" fill="#3498db" stroke="#2980b9" stroke-width="1" rx="3" ry="3"/>
                <text x="200" y="230" text-anchor="middle" font-family="Arial" font-size="12" fill="white">Topology Data (HELLO)</text>

                <!-- MQTT Format -->
                <rect x="520" y="130" width="160" height="30" fill="#9b59b6" stroke="#8e44ad" stroke-width="1" rx="3" ry="3"/>
                <text x="600" y="150" text-anchor="middle" font-family="Arial" font-size="12" fill="white">nodes/+/sensors/+</text>

                <rect x="520" y="170" width="160" height="30" fill="#9b59b6" stroke="#8e44ad" stroke-width="1" rx="3" ry="3"/>
                <text x="600" y="190" text-anchor="middle" font-family="Arial" font-size="12" fill="white">nodes/+/actuators/+/set</text>

                <rect x="520" y="210" width="160" height="30" fill="#9b59b6" stroke="#8e44ad" stroke-width="1" rx="3" ry="3"/>
                <text x="600" y="230" text-anchor="middle" font-family="Arial" font-size="12" fill="white">network/topology</text>
            </svg>
            <p class="diagram-title">Figure 7: EAODV to MQTT Protocol Translation</p>
        </div>

        <h4>Sensor Reading Mapping</h4>
        <p><strong>MQTT Topic:</strong> <code>eaodv/nodes/{node_id}/sensors/{sensor_type}</code></p>
        <div class="json-example">
{
  "node_id": "node-A",
  "mac": "AA:BB:CC:DD:EE:01",
  "value": 23.5,
  "timestamp": 1614878400.123
}
        </div>

        <h4>Actuator Command Mapping</h4>
        <p><strong>MQTT Topic:</strong> <code>eaodv/nodes/{node_id}/actuators/{actuator_type}/set</code></p>
        <div class="json-example">
{
  "value": true,
  "command_id": "cmd123",
  "timestamp": 1614878400.123
}
        </div>

        <h4>Node Capabilities Mapping</h4>
        <p><strong>MQTT Topic:</strong> <code>eaodv/nodes/{node_id}/capabilities</code></p>
        <div class="json-example">
{
  "node_id": "node-A",
  "mac": "AA:BB:CC:DD:EE:01",
  "sensors": ["temperature", "humidity"],
  "actuators": ["led", "motor"],
  "timestamp": 1614878400.123
}
        </div>

        <h4>Network Topology Mapping</h4>
        <p><strong>MQTT Topic:</strong> <code>eaodv/network/topology</code></p>
        <div class="json-example">
{
  "nodes": [
    {"id": "node-A", "mac": "AA:BB:CC:DD:EE:01", "capabilities": {...}},
    {"id": "node-B", "mac": "AA:BB:CC:DD:EE:02", "capabilities": {...}}
  ],
  "links": [
    {"source": "AA:BB:CC:DD:EE:01", "target": "AA:BB:CC:DD:EE:02"}
  ],
  "timestamp": 1614878400.123
}
        </div>

        <h4>Broker Election Mapping</h4>
        <p><strong>MQTT Topic:</strong> <code>eaodv/broker/election</code></p>
        <div class="json-example">
{
  "primary": {
    "node_id": "node-C",
    "mac": "AA:BB:CC:DD:EE:03",
    "score": 85,
    "wifi_strength": -42,
    "battery": 90
  },
  "backups": [
    {
      "node_id": "node-A",
      "mac": "AA:BB:CC:DD:EE:01",
      "score": 72,
      "wifi_strength": -58,
      "battery": 65
    }
  ],
  "timestamp": 1614878400.123
}
        </div>
    </div>

    <div class="section">
        <h3>Use Cases and Benefits</h3>

        <div class="diagram">
            <svg width="800" height="500" xmlns="http://www.w3.org/2000/svg">
                <!-- Background Rectangle -->
                <rect x="10" y="10" width="780" height="480" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2" rx="5" ry="5"/>

                <!-- Title -->
                <text x="400" y="40" text-anchor="middle" font-family="Arial" font-size="18" font-weight="bold">MQTT Integration Use Cases</text>

                <!-- Use Case 1: Remote Monitoring -->
                <rect x="50" y="70" width="700" height="120" fill="#ebf5fb" stroke="#3498db" stroke-width="2" rx="5" ry="5"/>
                <text x="400" y="90" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">Use Case 1: Remote Sensor Monitoring</text>

                <!-- Flow diagram -->
                <rect x="100" y="110" width="100" height="50" fill="#3498db" stroke="#2980b9" stroke-width="2" rx="5" ry="5"/>
                <text x="150" y="140" text-anchor="middle" font-family="Arial" font-size="12" fill="white">EAODV Sensors</text>

                <rect x="250" y="110" width="100" height="50" fill="#2ecc71" stroke="#27ae60" stroke-width="2" rx="5" ry="5"/>
                <text x="300" y="135" text-anchor="middle" font-family="Arial" font-size="12" fill="white">Gateway</text>
                <text x="300" y="150" text-anchor="middle" font-family="Arial" font-size="10" fill="white">Aggregation</text>

                <rect x="400" y="110" width="100" height="50" fill="#9b59b6" stroke="#8e44ad" stroke-width="2" rx="5" ry="5"/>
                <text x="450" y="135" text-anchor="middle" font-family="Arial" font-size="12" fill="white">MQTT Broker</text>
                <text x="450" y="150" text-anchor="middle" font-family="Arial" font-size="10" fill="white">Topics</text>

                <rect x="550" y="110" width="150" height="50" fill="#e74c3c" stroke="#c0392b" stroke-width="2" rx="5" ry="5"/>
                <text x="625" y="135" text-anchor="middle" font-family="Arial" font-size="12" fill="white">External Applications</text>
                <text x="625" y="150" text-anchor="middle" font-family="Arial" font-size="10" fill="white">Dashboards, Analytics</text>

                <line x1="200" y1="135" x2="250" y2="135" stroke="#3498db" stroke-width="2"/>
                <polygon points="250,135 240,130 240,140" fill="#3498db"/>

                <line x1="350" y1="135" x2="400" y2="135" stroke="#2ecc71" stroke-width="2"/>
                <polygon points="400,135 390,130 390,140" fill="#2ecc71"/>

                <line x1="500" y1="135" x2="550" y2="135" stroke="#9b59b6" stroke-width="2"/>
                <polygon points="550,135 540,130 540,140" fill="#9b59b6"/>

                <!-- Use Case 2: Remote Control -->
                <rect x="50" y="210" width="700" height="120" fill="#eaf2f8" stroke="#3498db" stroke-width="2" rx="5" ry="5"/>
                <text x="400" y="230" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">Use Case 2: Remote Actuator Control</text>

                <!-- Flow diagram reverse -->
                <rect x="100" y="250" width="100" height="50" fill="#3498db" stroke="#2980b9" stroke-width="2" rx="5" ry="5"/>
                <text x="150" y="275" text-anchor="middle" font-family="Arial" font-size="12" fill="white">EAODV</text>
                <text x="150" y="290" text-anchor="middle" font-family="Arial" font-size="10" fill="white">Actuators</text>

                <rect x="250" y="250" width="100" height="50" fill="#2ecc71" stroke="#27ae60" stroke-width="2" rx="5" ry="5"/>
                <text x="300" y="275" text-anchor="middle" font-family="Arial" font-size="12" fill="white">Gateway</text>
                <text x="300" y="290" text-anchor="middle" font-family="Arial" font-size="10" fill="white">Translation</text>

                <rect x="400" y="250" width="100" height="50" fill="#9b59b6" stroke="#8e44ad" stroke-width="2" rx="5" ry="5"/>
                <text x="450" y="275" text-anchor="middle" font-family="Arial" font-size="12" fill="white">MQTT Broker</text>
                <text x="450" y="290" text-anchor="middle" font-family="Arial" font-size="10" fill="white">Command Topics</text>

                <rect x="550" y="250" width="150" height="50" fill="#e74c3c" stroke="#c0392b" stroke-width="2" rx="5" ry="5"/>
                <text x="625" y="275" text-anchor="middle" font-family="Arial" font-size="12" fill="white">External Controllers</text>
                <text x="625" y="290" text-anchor="middle" font-family="Arial" font-size="10" fill="white">Apps, Automation</text>

                <line x1="550" y1="275" x2="500" y2="275" stroke="#e74c3c" stroke-width="2"/>
                <polygon points="500,275 510,270 510,280" fill="#e74c3c"/>

                <line x1="400" y1="275" x2="350" y2="275" stroke="#9b59b6" stroke-width="2"/>
                <polygon points="350,275 360,270 360,280" fill="#9b59b6"/>

                <line x1="250" y1="275" x2="200" y2="275" stroke="#2ecc71" stroke-width="2"/>
                <polygon points="200,275 210,270 210,280" fill="#2ecc71"/>

                <!-- Use Case 3: Network Visualization -->
                <rect x="50" y="350" width="700" height="120" fill="#e8f8f5" stroke="#27ae60" stroke-width="2" rx="5" ry="5"/>
                <text x="400" y="370" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">Use Case 3: Network Visualization</text>

                <!-- Network visualization diagram -->
                <rect x="80" y="390" width="120" height="60" fill="#3498db" stroke="#2980b9" stroke-width="2" rx="5" ry="5"/>
                <text x="140" y="425" text-anchor="middle" font-family="Arial" font-size="12" fill="white">EAODV Network</text>

                <rect x="250" y="390" width="120" height="60" fill="#2ecc71" stroke="#27ae60" stroke-width="2" rx="5" ry="5"/>
                <text x="310" y="415" text-anchor="middle" font-family="Arial" font-size="12" fill="white">Gateway</text>
                <text x="310" y="430" text-anchor="middle" font-family="Arial" font-size="10" fill="white">Topology Collection</text>

                <rect x="420" y="390" width="120" height="60" fill="#9b59b6" stroke="#8e44ad" stroke-width="2" rx="5" ry="5"/>
                <text x="480" y="415" text-anchor="middle" font-family="Arial" font-size="12" fill="white">MQTT Broker</text>
                <text x="480" y="430" text-anchor="middle" font-family="Arial" font-size="10" fill="white">network/topology</text>

                <rect x="590" y="390" width="130" height="60" fill="#e74c3c" stroke="#c0392b" stroke-width="2" rx="5" ry="5"/>
                <text x="655" y="415" text-anchor="middle" font-family="Arial" font-size="12" fill="white">Web Dashboard</text>
                <text x="655" y="430" text-anchor="middle" font-family="Arial" font-size="10" fill="white">Interactive Visualization</text>

                <line x1="200" y1="420" x2="250" y2="420" stroke="#3498db" stroke-width="2"/>
                <polygon points="250,420 240,415 240,425" fill="#3498db"/>

                <line x1="370" y1="420" x2="420" y2="420" stroke="#2ecc71" stroke-width="2"/>
                <polygon points="420,420 410,415 410,425" fill="#2ecc71"/>

                <line x1="540" y1="420" x2="590" y2="420" stroke="#9b59b6" stroke-width="2"/>
                <polygon points="590,420 580,415 580,425" fill="#9b59b6"/>
            </svg>
            <p class="diagram-title">Figure 8: MQTT Integration Use Cases</p>
        </div>

        <h4>1. Remote Sensor Monitoring</h4>

        <p>
            The MQTT integration would allow external applications to monitor sensor data from across the EAODV network:
        </p>

        <div class="step-container">
            <div class="step">
                <span class="step-number">1</span>
                <strong>Sensor Data Collection:</strong> The EAODV network collects sensor readings from various nodes.
            </div>

            <div class="step">
                <span class="step-number">2</span>
                <strong>Gateway Aggregation:</strong> The gateway node periodically queries or receives sensor updates from EAODV nodes.
            </div>

            <div class="step">
                <span class="step-number">3</span>
                <strong>MQTT Publication:</strong> The gateway publishes sensor data to appropriate MQTT topics.
            </div>

            <div class="step">
                <span class="step-number">4</span>
                <strong>External Consumption:</strong> Dashboard applications, data logging services, or analytics platforms
                subscribe to relevant topics and process the data.
            </div>
        </div>

        <h4>2. Remote Actuator Control</h4>

        <p>
            External applications could control actuators on EAODV nodes through MQTT commands:
        </p>

        <div class="step-container">
            <div class="step">
                <span class="step-number">1</span>
                <strong>Command Publication:</strong> An external application publishes a command to an actuator topic
                (e.g., <code>eaodv/nodes/node-A/actuators/led/set</code>).
            </div>

            <div class="step">
                <span class="step-number">2</span>
                <strong>Gateway Processing:</strong> The gateway receives the command and translates it to an EAODV write operation.
            </div>

            <div class="step">
                <span class="step-number">3</span>
                <strong>EAODV Command Distribution:</strong> The gateway sends an E-RREQ with WRITE operation type to the target node.
            </div>

            <div class="step">
                <span class="step-number">4</span>
                <strong>Actuator Control:</strong> The target node receives the command and controls the actuator accordingly.
            </div>

            <div class="step">
                <span class="step-number">5</span>
                <strong>Status Feedback:</strong> The result of the operation is published back to MQTT for confirmation.
            </div>
        </div>

        <h4>3. Network Monitoring and Visualization</h4>

        <p>
            The gateway could publish network topology and health information to MQTT for monitoring and visualization:
        </p>

        <div class="step-container">
            <div class="step">
                <span class="step-number">1</span>
                <strong>Topology Collection:</strong> The gateway periodically retrieves the current network topology from EAODV.
            </div>

            <div class="step">
                <span class="step-number">2</span>
                <strong>MQTT Publication:</strong> The gateway publishes the topology information to MQTT.
            </div>

            <div class="step">
                <span class="step-number">3</span>
                <strong>Visualization:</strong> A web dashboard subscribes to the topology topic and creates a real-time
                network visualization.
            </div>
        </div>
    </div>

    <div class="section">
        <h3>Challenges and Considerations</h3>

        <h4>1. Performance and Resource Constraints</h4>

        <div class="note">
            <p>
                The gateway node will need more computational resources and power than standard EAODV nodes
                since it's running both Bluetooth and WiFi/Ethernet interfaces, as well as performing protocol translation.
            </p>
            <p>
                Consider using a Raspberry Pi or similar device with adequate power supply for the gateway node.
            </p>
        </div>

        <h4>2. Security Considerations</h4>

        <div class="warning">
            <p>
                The gateway creates a bridge between your otherwise isolated Bluetooth mesh and the broader IP network,
                potentially introducing security risks.
            </p>
            <ul>
                <li>Use TLS for MQTT connections</li>
                <li>Implement authentication for the MQTT broker</li>
                <li>Consider command validation and rate limiting</li>
                <li>Implement access control for sensitive actuator commands</li>
            </ul>
        </div>

        <h4>3. Data Consistency and Synchronization</h4>

        <div class="note">
            <p>
                The gateway needs to handle potential connectivity issues on both sides:
            </p>
            <ul>
                <li>MQTT broker disconnections</li>
                <li>EAODV network partitions or node failures</li>
                <li>Gateway node restarts or power failures</li>
            </ul>
            <p>
                Consider implementing store-and-forward capabilities, message queuing, and state reconciliation mechanisms.
            </p>
        </div>

        <h4>4. Scaling and Multiple Gateways</h4>

        <div class="note">
            <p>
                For larger EAODV networks, you might need multiple gateway nodes. This introduces challenges around:
            </p>
            <ul>
                <li>Ensuring consistent MQTT topic mapping across gateways</li>
                <li>Preventing duplicate publications</li>
                <li>Load balancing and gateway coordination</li>
            </ul>
        </div>
    </div>

    <div class="section">
        <h3>Trade-offs and Considerations for School Projects</h3>

        <p>
            While MQTT integration offers significant capabilities, it's important to consider whether it's appropriate
            for your current school project scope:
        </p>

        <h4>Pros of MQTT Integration:</h4>

        <ul>
            <li class="pro">Extends network reach beyond Bluetooth limits</li>
            <li class="pro">Enables integration with existing IoT platforms and cloud services</li>
            <li class="pro">Facilitates data visualization through standard dashboards</li>
            <li class="pro">Demonstrates broader IoT ecosystem understanding</li>
            <li class="pro">Creates opportunities for more advanced features and demonstrations</li>
        </ul>

        <h4>Cons of MQTT Integration:</h4>

        <ul>
            <li class="con">Increases project complexity significantly</li>
            <li class="con">Requires additional hardware for the gateway node</li>
            <li class="con">Introduces dependencies on external services (MQTT broker)</li>
            <li class="con">May dilute focus from the core EAODV protocol demonstration</li>
            <li class="con">Adds security considerations that may be beyond project scope</li>
        </ul>

        <div class="note">
            <p>
                <strong>Recommendation for School Projects:</strong> If your primary goal is to demonstrate the EAODV routing
                protocol and Bluetooth mesh networking, you might want to focus on those aspects first and consider
                MQTT integration as a potential future enhancement or extension. This approach allows you to:
            </p>
            <ul>
                <li>Thoroughly demonstrate and test the core EAODV functionality</li>
                <li>Create a solid foundation before adding additional complexity</li>
                <li>Present MQTT integration as a future direction in your project documentation</li>
            </ul>
        </div>